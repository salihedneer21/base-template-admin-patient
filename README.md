# Specode React Vite Template

Vite + React 19 + React Router + Tailwind CSS v4 + Convex.

## Commands

```bash
pnpm dev            # Start Convex + Vite dev servers (http://localhost:5173)
pnpm dev:vite       # Start Vite dev server only
pnpm dev:convex     # Start Convex dev server + Vite concurrently
pnpm build          # Deploy Convex and build for production
pnpm lint           # TypeScript check + ESLint
```

> **Note:** This template uses pnpm v8 (`packageManager` field in package.json). When developing locally, you can use newer pnpm versions. However, Specode AI Coder runs on WebContainers which use pnpm 8.15.6 - keeping the lockfile compatible with v8 ensures faster installs and avoids compatibility warnings.

## Routing

Add routes in `src/router.tsx` under the `children` array. `src/App.tsx` renders the `Outlet` shell; create new pages in `src/pages/**` and reference them in the router.

## Styling (Tailwind v4)

Tailwind is enabled via `@tailwindcss/vite`. Global styles are just `@import 'tailwindcss';` in `src/index.css`. Use utility classes in components (see `src/pages/Home.tsx` for examples).

## Path Aliases

Use `@/` as an alias for `src/`:

```typescript
import { convex } from "@/lib/convex";
import Home from "@/pages/Home";
```

**Case-sensitive imports:** WebContainers and production Linux filesystems are case-sensitive. Ensure import casing matches filenames exactly (e.g., `checkbox.tsx` vs `Checkbox.tsx`), or Vite will fail to resolve the module.

## Convex

Client setup: `src/lib/convex.ts` exports the `convex` client, wrapped in `ConvexProvider` in `src/main.tsx`.

## Auth (Better Auth)

This project uses **Better Auth** with the **Convex Better Auth component** for
email/password auth plus password reset via email OTP codes, and a cross-domain cookie flow for
Convex auth tokens. Client wiring is in `src/lib/auth-client.ts`, server wiring
is in `convex/auth.ts`, and routes are registered in `convex/http.ts`.

### Auth setup (first-time)

Generate a Better Auth secret and set it in Convex:

```bash
openssl rand -base64 32 | tr -d '\n' | npx convex env set BETTER_AUTH_SECRET
```

> Keep this secret stable across deploys. Rotating it invalidates sessions.

### Production env vars (required)

Convex / server:
- `BETTER_AUTH_SECRET` - Strong secret (32+ chars). Required.
- `RESEND_API_KEY` - Resend API key for sending auth emails.
- `AUTH_EMAIL` - From-address for reset emails (must be a verified sender in Resend).
- `AUTH_EMAIL_NAME` - Optional sender display name.
- `SITE_URL` - Your frontend URL. Required in production for cross-domain flows.

Client / browser:
- `VITE_CONVEX_URL` - Convex deployment URL (auto-generated by `npx convex dev`).

### CORS note

Auth routes are registered with `{ cors: true }` in `convex/http.ts`. This is
convenient for dev, but you may want to restrict allowed origins in production.

### Cross-domain session loop fix

The default cross-domain client triggers a session refetch whenever it receives
`Set-Better-Auth-Cookie` â€” including `/get-session` responses. The Convex Better
Auth plugin sets a JWT cookie on `/get-session`, which can cause a refetch loop.

We use a small local wrapper in `src/lib/cross-domain-client.ts` that skips the
refetch notification for `/get-session` responses. This keeps auth reactive
without continuous `/get-session` requests.

### Maintenance note

`src/lib/cross-domain-client.ts` is a small wrapper based on the upstream
cross-domain client. If you upgrade `@convex-dev/better-auth` or `better-auth`,
review upstream changes and re-sync if needed.

### Getting Started

```bash
npx convex dev   # Initialize project, set up env vars, start dev server
```

This creates a `.env.local` file with `VITE_CONVEX_URL` automatically.

### Environment Variables

Client-side (browser):
- `VITE_CONVEX_URL` - Convex deployment URL (auto-generated)

Server-side (Convex functions):
```bash
npx convex env set API_KEY "your-secret-key"
```

**Note:** Do not expose API keys to the browser. Use Convex environment variables for server-side secrets.

### Backend Functions

Define your schema in `convex/schema.ts` and create functions in the `convex/` directory:

```typescript
// convex/tasks.ts
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";

export const list = query({
  handler: async (ctx) => {
    return await ctx.db.query("tasks").collect();
  },
});

export const create = mutation({
  args: { text: v.string() },
  handler: async (ctx, args) => {
    await ctx.db.insert("tasks", { text: args.text, isCompleted: false });
  },
});
```

### React Hooks

```typescript
import { useQuery, useMutation } from "convex/react";
import { api } from "../convex/_generated/api";

const tasks = useQuery(api.tasks.list);
const createTask = useMutation(api.tasks.create);
```

### Common CLI Commands

```bash
npx convex dev              # Start dev server (syncs functions, generates types)
npx convex deploy           # Deploy to production
npx convex codegen          # Regenerate TypeScript types
npx convex env set KEY val  # Set environment variable
npx convex logs             # View function logs
```

For detailed documentation, see `CLAUDE.md` and the [Convex documentation](https://docs.convex.dev).
